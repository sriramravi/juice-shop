- name: Define group suffixes for validation
  set_fact:
    group_suffixes:
      - VIEWERS
      - CONTRIBUTORS
      - OWNERS
      - SRE

- name: Build full group names from BA number
  set_fact:
    group_names: >-
      {%- set names = [] -%}
      {%- for suffix in group_suffixes -%}
      {%- set _ = names.append('O_' + ba_number_uc + '_' + suffix) -%}
      {%- endfor -%}
      {{ names }}

- name: Initialize group IDs array
  set_fact:
    checkmarx_group_ids: []

- name: Validate and fetch group IDs for each role
  include_tasks: group_validation.yml
  loop: "{{ group_names }}"
  loop_control:
    loop_var: group_name
    label: "Validating group: {{ group_name }}"
  when: unified_auth_check | default(false) | bool

- name: Display all collected group IDs
  debug:
    msg:
      - "Total groups validated: {{ checkmarx_group_ids | length }}"
      - "Group IDs: {{ checkmarx_group_ids }}"
  when: unified_auth_check | default(false) | bool
